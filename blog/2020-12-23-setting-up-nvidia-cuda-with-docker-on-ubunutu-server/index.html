<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.4.0"/><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 1qsxih2">.css-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1qsxih2{max-width:1200px;}}</style><title data-react-helmet="true"></title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="viewport" content="initial-scale=1, width=device-width"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link as="script" rel="preload" href="/webpack-runtime-50e0d37378e5e962947b.js"/><link as="script" rel="preload" href="/framework-d6d5e2b89c78b2abaef7.js"/><link as="script" rel="preload" href="/app-7d2eeea4c5090ac1194c.js"/><link as="script" rel="preload" href="/117fb336e4bc1ede79596e75b5ae5d2880838c24-d492c486524e64467702.js"/><link as="script" rel="preload" href="/component---src-pages-blog-mdx-slug-js-52a611415d615843b3a6.js"/><link as="fetch" rel="preload" href="/page-data/blog/2020-12-23-setting-up-nvidia-cuda-with-docker-on-ubunutu-server/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><title>Setting up Nivdia CUDA on Ubunutu server</title><main><h1>Setting up Nivdia CUDA on Ubunutu server</h1><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><p>December 23, 2020</p><p>I&#x27;ve been having an interest in machine learning lately and wanted to configure my own server for doing machine learning on. This tutorial will assume you have a decent grasp on the command line and that you figured out how to install ubuntu server fresh. When installing ubuntu server it will ask you if you want to install docker. If you want to say yes it didn&#x27;t work for me but my installer had an error in it so maybe that&#x27;s why. Just in case though this tutorial will explain how to install docker (basically it is just go to the site and follow the directions but if you just google around you can get lost).</p><p>Disclaimer I&#x27;m still learning but hopefully this helps. Also this tutorial only works if you have one of the following gpus: NVIDIA TITAN V, TITAN Xp, TITAN X (Pascal), NVIDIA Quadro GV100, GP100 and P6000, NVIDIA DGX. Otherwise go <a href="https://www.tensorflow.org/install/gpu">here</a></p><p>The first step in this tutorial is to go to the <a href="https://www.nvidia.com/Download/index.aspx?lang=en-us">Nvidia site</a> and download the correct driver for your GPU and for your OS. As outlined in the <a href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.htm">Nvidia Documentation</a> you can check your Nvidia card by running the following command on your server:</p><pre><code class="language-shell{promptUser:" metastring="lucas}{promptHost: dev.localhost}">    lspci | grep -i nvidia
</code></pre><p>You will want a relatively new GPU and you can check if it is compatible with CUDA <a href="https://developer.nvidia.com/cuda-gpus">here</a></p><p>Now copy the driver onto your server. I used secure copy (scp) it looked something like this:</p><pre><code class="language-shell"> scp lucas@192.168.0.20:~/nvidia-driver.run /Users/lucas/Desktop/NVIDIA-Linux-x86_64-450.80.02.run
</code></pre><p>Note that I&#x27;m on Mac and my file is on the desktop. Also note that my server ip is a lan ip and it is 192.168.0.20 (I statically configured the ip in my router so I don&#x27;t have to keep finding the server address). This command will vary depending on your system.</p><p>Then I logged back into the server and ran the driver but it didn&#x27;t work. I forgot to disable nouveau.</p><p>To disable nouveau I created a file /usr/lib/modprobe.d/blacklist-nouveau.conf with nano:</p><pre><code class="language-shell">sudo nano /usr/lib/modprobe.d/blacklist-nouveau.conf
</code></pre><p>Then I added the following contents (as per the documentation listed above:
{% highlight dockerfile %}
blacklist nouveau
options nouveau modeset=0</p><pre><code>
Then I ran the following command:
```shell
sudo update-initramfs -u
</code></pre><p>Also while I was at it I installed gcc which is a dependency of CUDA. I don&#x27;t think the driver depends on it tho. And I installed make which the driver depends on.</p><pre><code class="language-shell">sudo apt install gcc
gcc --version
sudo apt install make
</code></pre><p>Then I ran the script again with</p><pre><code class="language-shell">sudo sh ./nvidia-driver.run
</code></pre><p>Then I installed docker as the site recommends <a href="https://docs.docker.com/engine/install/ubuntu/">here</a>. I had some issues with the previous install from snap (don&#x27;t get me wrong snap is great when it works) but, I got those figured out.</p><p>Then I installed nvidia-docker2 as per <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">here</a>. Those commands were:</p><pre><code class="language-shell">distribution=$(. /etc/os-release;echo $ID$VERSION_ID)    &amp;&amp; curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -    &amp;&amp; curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list
sudo apt-get update
sudo apt-get install nvidia-docker2
sudo systemctl restart docker
</code></pre><p>Then the next thing to do is to install CUDA. I followed the instructions <a href="https://developer.nvidia.com/cuda-downloads">here</a> for ubuntu this is kind of tricky because you can&#x27;t restart after the install or else you&#x27;ll end up with ubuntu desktop. I found this out the hard way and had to reinstall the server (after trying to remove x11 - aka - the desktop)
Here are the commands I used to install CUDA:</p><pre><code class="language-shell">wget https://developer.download.nvidia.com/compute/cuda/11.2.0/local_installers/cuda_11.2.0_460.27.04_linux.run
sudo sh cuda_11.2.0_460.27.04_linux.run
sudo apt-get autoremove
</code></pre><p>Note that apt-get autoremove will remove x11 and the desktop environment as well as some useful packages like the docs and such but oh well.</p><p>Lastly verify your install with:</p><pre><code class="language-shell">nvidia-smi
</code></pre><p><img src="/assets/2020-12-23-GPUs/nvidia-smi.png" alt="You will see something like this"/></p><p>Once you have CUDA installed properly you can test it out properly with docker. I followed <a href="https://powersj.io/post/ubuntu-server-nvidia-cuda/">this</a> tutorial to get started. Basically you just create a Dockerfile. Something like this:</p><pre><code class="language-dockerfile">mkdir docker
cd docker
nano Dockerfile
</code></pre><p>Then in the Dockerfile:</p><pre><code class="language-dockerfile">FROM nvidia/cuda:11.1-base
CMD nvidia-smi
</code></pre><p>Then to build and run the file:</p><pre><code class="language-shell">docker build -t nvidia-test .
sudo docker run --gpus all nvidia-test
</code></pre><p>If you have all this working I would download tensor flow from docker with:</p><pre><code class="language-shell">docker pull nvcr.io/nvidia/tensorflow:20.12-tf1-py3
 docker run --gpus all -it --rm nvcr.io/nvidia/tensorflow:20.12-tf1-py3
</code></pre><p>Then once you start on your project you might want to use volumes as outlined <a href="https://ngc.nvidia.com/catalog/containers/nvidia:tensorflow">here</a> Note that this build of the tensorflow in the docker container is old if you want to run the new version of tensorflow run <strong>Pip install --quite --upgrade tf-nightly</strong> then your tutorials will work.</p></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2020-12-23-setting-up-nvidia-cuda-with-docker-on-ubunutu-server/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-bb53d728883c387f23a4.js"],"app":["/app-7d2eeea4c5090ac1194c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-4cadfaafd24a7cb04fe5.js"],"component---src-pages-blog-mdx-slug-js":["/component---src-pages-blog-mdx-slug-js-52a611415d615843b3a6.js"],"component---src-pages-index-js":["/component---src-pages-index-js-4aa6d4b2d3ec3dc028d0.js"],"component---src-pages-tech-js":["/component---src-pages-tech-js-1bbfeea0cfbe7e9ad0b6.js"],"component---src-pages-travel-js":["/component---src-pages-travel-js-78f4a18dcd47e15365af.js"]};/*]]>*/</script><script src="/polyfill-bb53d728883c387f23a4.js" nomodule=""></script><script src="/component---src-pages-blog-mdx-slug-js-52a611415d615843b3a6.js" async=""></script><script src="/117fb336e4bc1ede79596e75b5ae5d2880838c24-d492c486524e64467702.js" async=""></script><script src="/app-7d2eeea4c5090ac1194c.js" async=""></script><script src="/framework-d6d5e2b89c78b2abaef7.js" async=""></script><script src="/webpack-runtime-50e0d37378e5e962947b.js" async=""></script></body></html>